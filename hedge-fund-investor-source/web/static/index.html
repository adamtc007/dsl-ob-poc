<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Hedge Fund DSL Agent - Chat Interface</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    "Helvetica Neue", Arial, sans-serif;
                background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
                color: #f1f5f9;
                min-height: 100vh;
                padding: 20px;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                display: flex;
                flex-direction: column;
                height: calc(100vh - 40px);
            }

            header {
                text-align: center;
                margin-bottom: 20px;
                padding: 20px;
                background: rgba(30, 41, 59, 0.5);
                border-radius: 12px;
                backdrop-filter: blur(10px);
            }

            h1 {
                color: #38bdf8;
                font-size: 2rem;
                margin-bottom: 8px;
            }

            .subtitle {
                color: #94a3b8;
                font-size: 0.9rem;
            }

            .status-bar {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 10px;
                margin-top: 10px;
                font-size: 0.85rem;
            }

            .status-indicator {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background-color: #ef4444;
                animation: pulse 2s infinite;
            }

            .status-indicator.connected {
                background-color: #22c55e;
            }

            @keyframes pulse {
                0%,
                100% {
                    opacity: 1;
                }
                50% {
                    opacity: 0.5;
                }
            }

            .main-content {
                flex: 1;
                display: flex;
                gap: 20px;
                overflow: hidden;
            }

            .chat-section {
                flex: 1;
                display: flex;
                flex-direction: column;
                background: rgba(30, 41, 59, 0.5);
                border-radius: 12px;
                overflow: hidden;
                backdrop-filter: blur(10px);
            }

            .chat-container {
                flex: 1;
                overflow-y: auto;
                padding: 20px;
                scroll-behavior: smooth;
            }

            .message {
                margin-bottom: 16px;
                padding: 12px 16px;
                border-radius: 8px;
                max-width: 80%;
                word-wrap: break-word;
                animation: fadeIn 0.3s ease-in;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .user-message {
                background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
                margin-left: auto;
                text-align: right;
            }

            .agent-message {
                background: linear-gradient(135deg, #0f766e 0%, #0d9488 100%);
                margin-right: auto;
            }

            .message-header {
                font-size: 0.75rem;
                opacity: 0.8;
                margin-bottom: 6px;
            }

            .dsl-code {
                background: #1e1e3f;
                color: #a9b1d6;
                font-family: "Courier New", monospace;
                padding: 12px;
                border-radius: 6px;
                margin-top: 10px;
                white-space: pre-wrap;
                font-size: 0.85rem;
                border-left: 3px solid #38bdf8;
                overflow-x: auto;
            }

            .confidence-badge {
                display: inline-block;
                background: rgba(34, 197, 94, 0.2);
                color: #22c55e;
                padding: 2px 8px;
                border-radius: 12px;
                font-size: 0.75rem;
                margin-top: 6px;
            }

            .input-area {
                padding: 16px;
                background: rgba(15, 23, 42, 0.8);
                border-top: 1px solid rgba(148, 163, 184, 0.2);
            }

            .input-wrapper {
                display: flex;
                gap: 10px;
            }

            #user-input {
                flex: 1;
                padding: 12px 16px;
                border-radius: 8px;
                border: 1px solid rgba(148, 163, 184, 0.3);
                background: rgba(30, 41, 59, 0.8);
                color: #f1f5f9;
                font-size: 0.95rem;
                outline: none;
                transition: border-color 0.3s;
            }

            #user-input:focus {
                border-color: #38bdf8;
            }

            #send-btn {
                padding: 12px 24px;
                background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
                color: white;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                font-weight: 600;
                transition:
                    transform 0.2s,
                    box-shadow 0.2s;
            }

            #send-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(14, 165, 233, 0.4);
            }

            #send-btn:disabled {
                background: #475569;
                cursor: not-allowed;
                transform: none;
            }

            .dsl-viewer {
                width: 400px;
                background: rgba(30, 41, 59, 0.5);
                border-radius: 12px;
                padding: 20px;
                backdrop-filter: blur(10px);
                display: flex;
                flex-direction: column;
            }

            .dsl-viewer h2 {
                color: #38bdf8;
                font-size: 1.2rem;
                margin-bottom: 16px;
            }

            .dsl-display {
                flex: 1;
                background: #1e1e3f;
                border-radius: 8px;
                padding: 16px;
                overflow-y: auto;
                font-family: "Courier New", monospace;
                color: #a9b1d6;
                font-size: 0.85rem;
                line-height: 1.6;
                white-space: pre-wrap;
                border: 1px solid rgba(148, 163, 184, 0.2);
            }

            .empty-state {
                text-align: center;
                color: #64748b;
                padding: 40px 20px;
            }

            .suggestions {
                margin-top: 12px;
                padding: 12px;
                background: rgba(59, 130, 246, 0.1);
                border-radius: 6px;
                border-left: 3px solid #3b82f6;
            }

            .suggestions-title {
                font-size: 0.85rem;
                color: #94a3b8;
                margin-bottom: 8px;
            }

            .suggestion-item {
                font-size: 0.8rem;
                color: #cbd5e1;
                margin: 4px 0;
                padding-left: 12px;
            }

            .loading {
                display: inline-block;
                width: 12px;
                height: 12px;
                border: 2px solid rgba(255, 255, 255, 0.3);
                border-radius: 50%;
                border-top-color: white;
                animation: spin 1s linear infinite;
            }

            @keyframes spin {
                to {
                    transform: rotate(360deg);
                }
            }

            @media (max-width: 768px) {
                .main-content {
                    flex-direction: column;
                }

                .dsl-viewer {
                    width: 100%;
                    min-height: 300px;
                }

                .message {
                    max-width: 90%;
                }
            }

            /* Scrollbar styling */
            ::-webkit-scrollbar {
                width: 8px;
                height: 8px;
            }

            ::-webkit-scrollbar-track {
                background: rgba(30, 41, 59, 0.5);
            }

            ::-webkit-scrollbar-thumb {
                background: rgba(148, 163, 184, 0.5);
                border-radius: 4px;
            }

            ::-webkit-scrollbar-thumb:hover {
                background: rgba(148, 163, 184, 0.7);
            }
        </style>
    </head>
    <body>
        <div class="container">
            <header>
                <h1>üè¶ Hedge Fund DSL Agent</h1>
                <p class="subtitle">
                    Natural Language to Domain-Specific Language Translation
                </p>
                <div class="status-bar">
                    <div class="status-indicator" id="status-indicator"></div>
                    <span id="status-text">Connecting...</span>
                </div>
            </header>

            <div class="main-content">
                <div class="chat-section">
                    <div class="chat-container" id="chat">
                        <div class="message agent-message">
                            <div class="message-header">DSL Agent</div>
                            <div>
                                üëã Welcome! I'm your Hedge Fund DSL Agent. I can
                                help you create investor opportunities, process
                                KYC, manage subscriptions, and more using
                                natural language.
                            </div>
                            <div class="suggestions">
                                <div class="suggestions-title">
                                    üí° Try asking:
                                </div>
                                <div class="suggestion-item">
                                    ‚Ä¢ "Create an investor opportunity for Swiss
                                    corporation Alpine Capital"
                                </div>
                                <div class="suggestion-item">
                                    ‚Ä¢ "Start KYC process for the investor"
                                </div>
                                <div class="suggestion-item">
                                    ‚Ä¢ "Approve KYC with low risk rating"
                                </div>
                                <div class="suggestion-item">
                                    ‚Ä¢ "Create a subscription request for $5
                                    million USD"
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="input-area">
                        <div class="input-wrapper">
                            <input
                                type="text"
                                id="user-input"
                                placeholder="Type your message here..."
                                autofocus
                            />
                            <button id="send-btn">Send</button>
                        </div>
                    </div>
                </div>

                <div class="dsl-viewer">
                    <h2>üìã Generated DSL</h2>
                    <div class="dsl-display" id="dsl-display">
                        <div class="empty-state">
                            No DSL generated yet.<br /><br />
                            Start a conversation to see the generated DSL code
                            appear here.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // DOM Elements
            const chatContainer = document.getElementById("chat");
            const userInput = document.getElementById("user-input");
            const sendButton = document.getElementById("send-btn");
            const statusIndicator = document.getElementById("status-indicator");
            const statusText = document.getElementById("status-text");
            const dslDisplay = document.getElementById("dsl-display");

            let isLoading = false;

            // Check API health on load
            fetch("/api/health")
                .then((response) => response.json())
                .then((data) => {
                    if (data.status === "healthy") {
                        statusIndicator.classList.add("connected");
                        statusText.textContent = "Connected";
                    }
                })
                .catch((error) => {
                    console.error("Health check failed:", error);
                    statusText.textContent = "Connection Error";
                });

            // Add message to chat
            function addMessage(content, role, dsl = null, response = null) {
                const messageDiv = document.createElement("div");
                messageDiv.className = `message ${role === "user" ? "user-message" : "agent-message"}`;

                const headerDiv = document.createElement("div");
                headerDiv.className = "message-header";
                headerDiv.textContent = role === "user" ? "You" : "DSL Agent";
                messageDiv.appendChild(headerDiv);

                const contentDiv = document.createElement("div");
                contentDiv.textContent = content;
                messageDiv.appendChild(contentDiv);

                if (dsl) {
                    const dslDiv = document.createElement("div");
                    dslDiv.className = "dsl-code";
                    dslDiv.textContent = dsl;
                    messageDiv.appendChild(dslDiv);

                    // Update DSL viewer
                    dslDisplay.textContent = dsl;
                }

                if (response && response.confidence) {
                    const confidenceDiv = document.createElement("div");
                    confidenceDiv.className = "confidence-badge";
                    confidenceDiv.textContent = `Confidence: ${(response.confidence * 100).toFixed(0)}%`;
                    messageDiv.appendChild(confidenceDiv);
                }

                chatContainer.appendChild(messageDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }

            // Send message to server
            async function sendMessage() {
                const message = userInput.value.trim();
                if (!message || isLoading) return;

                // Add user message
                addMessage(message, "user");
                userInput.value = "";

                // Show loading state
                isLoading = true;
                sendButton.disabled = true;
                sendButton.innerHTML = '<span class="loading"></span>';

                try {
                    const response = await fetch("/api/chat", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({ message }),
                    });

                    const data = await response.json();

                    if (data.error) {
                        addMessage("Error: " + data.error, "agent");
                    } else {
                        addMessage(
                            data.message,
                            "agent",
                            data.dsl,
                            data.response,
                        );
                    }
                } catch (error) {
                    console.error("Error:", error);
                    addMessage(
                        "Failed to get response. Please try again.",
                        "agent",
                    );
                } finally {
                    // Reset loading state
                    isLoading = false;
                    sendButton.disabled = false;
                    sendButton.textContent = "Send";
                    userInput.focus();
                }
            }

            // Event listeners
            sendButton.addEventListener("click", sendMessage);
            userInput.addEventListener("keypress", (event) => {
                if (event.key === "Enter" && !event.shiftKey) {
                    event.preventDefault();
                    sendMessage();
                }
            });

            // Focus input on load
            userInput.focus();

            console.log("Hedge Fund DSL Agent initialized");
        </script>
    </body>
</html>
