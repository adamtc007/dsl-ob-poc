
üß™ **AI Agent Prompt/Response Capture** - 2025-11-03 20:28:45
=========================================================
ü§ñ **Mode**: Mock Agent (Simulated Responses)
‚ÑπÔ∏è  **Note**: Set GEMINI_API_KEY environment variable for real AI responses
üìã **Test Configuration**:
   CBU ID: CBU-1234
   Test Type: all

üìÑ **Current DSL State**:
   State: CREATED
   Version: 1
   DSL Length: 563 characters

üîç **KYC Agent Prompt/Response Capture**
=======================================

**Scenario 1: UCITS Fund**
üìù Nature: UCITS equity fund domiciled in LU
üì¶ Products: [CUSTODY FUND_ACCOUNTING]

üì§ **System Prompt to AI**:
```
You are an expert KYC/AML Compliance Officer for a major global bank.
Your job is to analyze a new client's "nature and purpose" and their "requested products" to determine the *minimum* required KYC documents and all relevant jurisdictions.

RULES:
1. Analyze the "nature and purpose" for entity type and domicile (e.g., "UCITS fund domiciled in LU" -> Domicile is "LU").
2. Analyze the products for regulatory impact (e.g., "TRANSFER_AGENT" implies AML checks on investors).
3. Respond ONLY with a single, minified JSON object. Do not include markdown ticks, "json", or any other conversational text.
4. The JSON format MUST be: {"required_documents": ["doc1", "doc2"], "jurisdictions": ["jur1", "jur2"]}

EXAMPLES:
- Input: "UCITS equity fund domiciled in LU", Products: ["CUSTODY"]
- Output: {"required_documents":["CertificateOfIncorporation","ArticlesOfAssociation","W8BEN-E"],"jurisdictions":["LU"]}
- Input: "US-based hedge fund", Products: ["TRANSFER_AGENT", "CUSTODY"]
- Output: {"required_documents":["CertificateOfLimitedPartnership","PartnershipAgreement","W9","AMLPolicy"],"jurisdictions":["US"]}
```

üì§ **User Prompt to AI**:
```
Nature and Purpose: "UCITS equity fund domiciled in LU", Products: [["CUSTODY" "FUND_ACCOUNTING"]]```

üì• **Mock AI Response**:
```json
{"required_documents":["CertificateOfIncorporation","ArticlesOfAssociation","W8BEN-E","CustodyAgreement","AccountingPolicy"],"jurisdictions":["LU"]}
```

‚úÖ **Parsed Result**:
   üìÑ Documents: [CertificateOfIncorporation ArticlesOfAssociation W8BEN-E CustodyAgreement AccountingPolicy]
   üåç Jurisdictions: [LU]


**Scenario 2: US Hedge Fund**
üìù Nature: US-based hedge fund
üì¶ Products: [PRIME_BROKERAGE TRANSFER_AGENT]

üì§ **System Prompt to AI**:
```
You are an expert KYC/AML Compliance Officer for a major global bank.
Your job is to analyze a new client's "nature and purpose" and their "requested products" to determine the *minimum* required KYC documents and all relevant jurisdictions.

RULES:
1. Analyze the "nature and purpose" for entity type and domicile (e.g., "UCITS fund domiciled in LU" -> Domicile is "LU").
2. Analyze the products for regulatory impact (e.g., "TRANSFER_AGENT" implies AML checks on investors).
3. Respond ONLY with a single, minified JSON object. Do not include markdown ticks, "json", or any other conversational text.
4. The JSON format MUST be: {"required_documents": ["doc1", "doc2"], "jurisdictions": ["jur1", "jur2"]}

EXAMPLES:
- Input: "UCITS equity fund domiciled in LU", Products: ["CUSTODY"]
- Output: {"required_documents":["CertificateOfIncorporation","ArticlesOfAssociation","W8BEN-E"],"jurisdictions":["LU"]}
- Input: "US-based hedge fund", Products: ["TRANSFER_AGENT", "CUSTODY"]
- Output: {"required_documents":["CertificateOfLimitedPartnership","PartnershipAgreement","W9","AMLPolicy"],"jurisdictions":["US"]}
```

üì§ **User Prompt to AI**:
```
Nature and Purpose: "US-based hedge fund", Products: [["PRIME_BROKERAGE" "TRANSFER_AGENT"]]```

üì• **Mock AI Response**:
```json
{"required_documents":["CertificateOfLimitedPartnership","PartnershipAgreement","W9","AMLPolicy","PrimeBrokerageAgreement","RiskManagementPolicy","InvestorQuestionnaire"],"jurisdictions":["US"]}
```

‚úÖ **Parsed Result**:
   üìÑ Documents: [CertificateOfLimitedPartnership PartnershipAgreement W9 AMLPolicy PrimeBrokerageAgreement RiskManagementPolicy InvestorQuestionnaire]
   üåç Jurisdictions: [US]


üîÑ **DSL Transformation Agent Prompt/Response Capture**
====================================================

üìù **Transformation Instruction**: Add TRANSFER_AGENT to the products list

üì§ **System Prompt to AI**:
```
You are an expert DSL (Domain Specific Language) architect for financial onboarding workflows.
Your role is to analyze existing DSL and transform it according to user instructions while maintaining correctness and consistency.

RULES:
1. Analyze the current DSL structure and understand its semantic meaning
2. Apply the requested transformation while preserving DSL syntax and structure
3. Ensure all changes are consistent with the target onboarding state
4. Provide clear explanations for all changes made
5. Respond ONLY with a single, well-formed JSON object
6. Do not include markdown, code blocks, or conversational text

DSL SYNTAX GUIDE:
- S-expressions format: (command args...)
- Case creation: (case.create (cbu.id "ID") (nature-purpose "DESC"))
- Products: (products.add "PRODUCT1" "PRODUCT2")
- KYC: (kyc.start (documents (document "DOC")) (jurisdictions (jurisdiction "JUR")))
- Services: (services.discover (for.product "PROD" (service "SVC")))
- Resources: (resources.plan (resource.create "NAME" (owner "OWNER") (var (attr-id "ID"))))
- Values: (values.bind (bind (attr-id "ID") (value "VAL")))

RESPONSE FORMAT:
{
  "new_dsl": "Complete transformed DSL as a string",
  "explanation": "Clear explanation of what was changed and why",
  "changes": ["List of specific changes made"],
  "confidence": 0.95
}
```

üì§ **User Prompt to AI**:
```
Current DSL:
(case.create
  (cbu.id "CBU-1234")
  (nature-purpose "UCITS equity fund domiciled in LU")
)

(products.add "CUSTODY" "FUND_ACCOUNTING")

(services.discover
  (for.product "CUSTODY"
    (service "CustodyService")
    (service "SettlementService")
  )
  (for.product "FUND_ACCOUNTING"
    (service "FundAccountingService")
  )
)

(resources.plan
  (resource.create "CustodyAccount"
    (owner "CustodyTech")
    (var (attr-id "123e4567-e89b-12d3-a456-426614174000"))
  )
)

(values.bind
  (bind (attr-id "123e4567-e89b-12d3-a456-426614174000") (value "CBU-1234"))
)

Instruction: Add TRANSFER_AGENT to the products list
Target State: CREATED

Additional Context: {"current_state":"CREATED","version_number":1}

Please transform the DSL according to the instruction while moving toward the target state.
```

üì• **Mock AI Response**:
```json
{"new_dsl":"(case.create\n  (cbu.id \"CBU-1234\")\n  (nature-purpose \"UCITS equity fund domiciled in LU\")\n)\n\n(products.add \"TRANSFER_AGENT\" \"CUSTODY\" \"FUND_ACCOUNTING\")\n\n(services.discover\n  (for.product \"CUSTODY\"\n    (service \"CustodyService\")\n    (service \"SettlementService\")\n  )\n  (for.product \"FUND_ACCOUNTING\"\n    (service \"FundAccountingService\")\n  )\n)\n\n(resources.plan\n  (resource.create \"CustodyAccount\"\n    (owner \"CustodyTech\")\n    (var (attr-id \"123e4567-e89b-12d3-a456-426614174000\"))\n  )\n)\n\n(values.bind\n  (bind (attr-id \"123e4567-e89b-12d3-a456-426614174000\") (value \"CBU-1234\"))\n)","explanation":"Added TRANSFER_AGENT to the products list as requested","changes":["Added TRANSFER_AGENT product"],"confidence":0.9}
```

‚úÖ **Parsed Result**:
   üìä Confidence: 0.90
   üìù Explanation: Added TRANSFER_AGENT to the products list as requested
   üîÑ Changes: [Added TRANSFER_AGENT product]

üìÑ **Transformed DSL** (first 300 chars):
```
(case.create
  (cbu.id "CBU-1234")
  (nature-purpose "UCITS equity fund domiciled in LU")
)

(products.add "TRANSFER_AGENT" "CUSTODY" "FUND_ACCOUNTING")

(services.discover
  (for.product "CUSTODY"
    (service "CustodyService")
    (service "SettlementService")
  )
  (for.product "FUND_ACCOUNTING"
...
```

‚úÖ **DSL Validation Agent Prompt/Response Capture**
=================================================

üìù **Validation Target**: Current DSL completeness and correctness

üì§ **System Prompt to AI**:
```
You are an expert DSL validator for financial onboarding workflows.
Your role is to analyze DSL for correctness, completeness, and best practices.

VALIDATION CRITERIA:
1. Syntax correctness (proper S-expression structure)
2. Semantic correctness (logical flow and consistency)
3. Completeness (required elements for the onboarding state)
4. Best practices (proper naming, structure, etc.)
5. Compliance considerations (regulatory requirements)

RESPONSE FORMAT:
{
  "is_valid": true/false,
  "validation_score": 0.95,
  "errors": ["List of syntax or semantic errors"],
  "warnings": ["List of potential issues"],
  "suggestions": ["List of improvement suggestions"],
  "summary": "Overall assessment of the DSL"
}
```

üì§ **User Prompt to AI**:
```
Please validate the following DSL:

(case.create
  (cbu.id "CBU-1234")
  (nature-purpose "UCITS equity fund domiciled in LU")
)

(products.add "CUSTODY" "FUND_ACCOUNTING")

(services.discover
  (for.product "CUSTODY"
    (service "CustodyService")
    (service "SettlementService")
  )
  (for.product "FUND_ACCOUNTING"
    (service "FundAccountingService")
  )
)

(resources.plan
  (resource.create "CustodyAccount"
    (owner "CustodyTech")
    (var (attr-id "123e4567-e89b-12d3-a456-426614174000"))
  )
)

(values.bind
  (bind (attr-id "123e4567-e89b-12d3-a456-426614174000") (value "CBU-1234"))
)

Provide a comprehensive validation assessment including errors, warnings, and suggestions for improvement.
```

üì• **Mock AI Response**:
```json
{"is_valid":true,"validation_score":0.8,"errors":[],"warnings":["No KYC requirements defined"],"suggestions":["Consider running 'discover-kyc' to generate KYC requirements","Ensure nature-purpose accurately reflects the entity type and domicile"],"summary":"DSL is valid but could be improved with additional onboarding steps"}
```

‚úÖ **Parsed Validation Result**:
   ‚úÖ Valid: true
   üìà Score: 0.80
   üìù Summary: DSL is valid but could be improved with additional onboarding steps
   ‚ö†Ô∏è  Warnings: [No KYC requirements defined]
   üí° Suggestions: [Consider running 'discover-kyc' to generate KYC requirements Ensure nature-purpose accurately reflects the entity type and domicile]

üéØ **Summary**:
- This capture shows the exact prompts sent to AI agents
- System prompts define the AI's role and response format
- User prompts contain the specific data and instructions
- Responses are structured JSON for reliable parsing
- ü§ñ **Mock responses used**: Set GEMINI_API_KEY for real AI testing
- üìã **Prompts are ready**: These exact prompts will work with real Gemini

üìÅ **Output saved to**: real_api_test.txt
